<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoC Gatherer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .result-item {
            border-left: 4px solid #007bff;
            margin-bottom: 10px;
            padding: 10px;
            background-color: white;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .source-badge {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">IoC Gatherer</h3>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="keywords" class="form-label">Enter IoCs (comma-separated)</label>
                            <input type="text" class="form-control" id="keywords" placeholder="e.g., 185.143.223.47, emotet.com, 5f4dcc3b5aa765d61d8327deb882cf99">
                        </div>
                        <button id="searchBtn" class="btn btn-primary">
                            <i class="fas fa-search"></i> Search IoCs
                        </button>
                        <button id="exportBtn" class="btn btn-success" disabled>
                            <i class="fas fa-file-excel"></i> Export to Excel
                        </button>
                    </div>
                </div>

                <div class="loading">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p>Searching for IoCs...</p>
                </div>

                <div id="results" class="card">
                    <div class="card-header bg-info text-white">
                        <h4 class="mb-0">Results</h4>
                    </div>
                    <div class="card-body" id="resultsBody">
                        <!-- Results will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentResults = [];

        document.getElementById('searchBtn').addEventListener('click', async () => {
            const keywords = document.getElementById('keywords').value.trim();
            if (!keywords) {
                alert('Please enter keywords to search');
                return;
            }

            const loading = document.querySelector('.loading');
            const resultsBody = document.getElementById('resultsBody');
            const exportBtn = document.getElementById('exportBtn');

            loading.style.display = 'block';
            resultsBody.innerHTML = '';
            exportBtn.disabled = true;

            try {
                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ keywords }),
                });

                const results = await response.json();
                currentResults = results;

                if (results.length === 0) {
                    resultsBody.innerHTML = '<div class="alert alert-info">No results found</div>';
                } else {
                    results.forEach(result => {
                        const resultDiv = document.createElement('div');
                        resultDiv.className = 'result-item';
                        
                        let details = '';
                        if (result.confidence) details += `<p>Confidence: ${result.confidence}</p>`;
                        if (result.country) details += `<p>Country: ${result.country}</p>`;
                        if (result.last_reported) details += `<p>Last Reported: ${result.last_reported}</p>`;
                        if (result.malicious) details += `<p>Malicious Detections: ${result.malicious}</p>`;
                        if (result.malware) details += `<p>Malware: ${result.malware}</p>`;
                        if (result.first_seen) details += `<p>First Seen: ${result.first_seen}</p>`;

                        resultDiv.innerHTML = `
                            <h5>${result.type} - ${result.value}</h5>
                            <span class="badge bg-primary source-badge">${result.source}</span>
                            ${details}
                        `;
                        resultsBody.appendChild(resultDiv);
                    });
                    exportBtn.disabled = false;
                }
            } catch (error) {
                resultsBody.innerHTML = '<div class="alert alert-danger">Error searching for IoCs</div>';
                console.error('Error:', error);
            } finally {
                loading.style.display = 'none';
            }
        });

        document.getElementById('exportBtn').addEventListener('click', async () => {
            if (currentResults.length === 0) {
                alert('No results to export');
                return;
            }

            try {
                const response = await fetch('/api/export', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ results: currentResults }),
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `ioc_results_${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.xlsx`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    a.remove();
                } else {
                    alert('Error exporting to Excel');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error exporting to Excel');
            }
        });
    </script>
</body>
</html> 